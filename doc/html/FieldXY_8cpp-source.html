<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>FieldXY.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; </center>
<hr><h1>FieldXY.cpp</h1><div class="fragment"><pre>00001 <span class="preprocessor">#include "Constants.h"</span>
00002 <span class="preprocessor">#include "Definitions.h"</span>
00003 <span class="preprocessor">#include "FieldXY.h"</span>
00004 <span class="preprocessor">#include "poisson.h"</span>
00005 
00006 
00007 FieldXY::FieldXY(<span class="keywordtype">int</span> nx, <span class="keywordtype">int</span> ny, <span class="keywordtype">float</span> diffx, <span class="keywordtype">float</span> diffy, string filename)
00008 { 
00009  <span class="keywordtype">int</span> j;
00010  NX=nx; NY=ny; dx=diffx; dy=diffy;
00011  bc=0.0; 
00012  out=fopen(filename.c_str(),<span class="stringliteral">"w"</span>); 
00013 
00014  <span class="comment">// the x,y grid:</span>
00015  
00016  x=<span class="keyword">new</span> <span class="keywordtype">float</span>[NX];
00017  y=<span class="keyword">new</span> <span class="keywordtype">float</span>[NY];
00018  <span class="keywordflow">for</span>(j=0;j&lt;NX;j++)
00019   x[j]=-0.5*(NX-1.0)*dx+j*dx;  
00020  <span class="keywordflow">for</span>(j=0;j&lt;NY;j++)
00021   y[j]=-0.5*(NY-1.0)*dy+j*dy; 
00022 
00023  <span class="comment">// field in row major order:</span>
00024 
00025  field=<span class="keyword">new</span> <span class="keywordtype">float</span>[NX*NY];
00026  
00027 }
00028 
00029 
00030 FieldXY::~FieldXY() 
00031 { 
00032  fclose(out);
00033  <span class="keyword">delete</span> x;
00034  <span class="keyword">delete</span> y; 
00035  <span class="keyword">delete</span> field; 
00036 }
00037 
00038 
00039 
00040 <span class="keywordtype">float</span>&amp; FieldXY::operator()(<span class="keywordtype">int</span> j, <span class="keywordtype">int</span> l) 
00041 {
00042  <span class="keywordflow">if</span>( j &gt;= 0 &amp;&amp; j &lt; NX &amp;&amp; l &gt;= 0 &amp;&amp; l &lt; NY) 
00043    <span class="keywordflow">return</span> field[l+j*NY];
00044  <span class="keywordflow">else</span> <span class="keywordflow">return</span> bc;
00045 }
00046 
00047 
00048 <span class="keywordtype">double</span> FieldXY::Field2Pic(<span class="keywordtype">double</span> pic_pos_x, <span class="keywordtype">double</span> pic_pos_y)
00049 {
00050  <span class="keywordtype">int</span> j1,j2,l1,l2;
00051  <span class="keywordtype">float</span> a1, a2, a3, a4;
00052 
00053  j1=(int)floor((pic_pos_x+0.5*(NX-1.0)*dx)/dx);
00054  j2=j1+1;
00055  l1=(int)floor((pic_pos_y+0.5*(NY-1.0)*dy)/dy); 
00056  l2=l1+1;
00057   
00058  a1=(x[j2]-pic_pos_x)*(pic_pos_y-y[l1]);
00059  a2=(x[j2]-pic_pos_x)*(y[l2]-pic_pos_y);
00060  a3=(pic_pos_x-x[j1])*(pic_pos_y-y[l1]);
00061  a4=(pic_pos_x-x[j1])*(y[l2]-pic_pos_y);
00062    
00063  <span class="keywordflow">return</span> this-&gt;operator()(j1,l1)*a2/(dx*dy)+this-&gt;operator()(j1,l2)*a1/(dx*dy)+
00064         this-&gt;operator()(j2,l1)*a4/(dx*dy)+this-&gt;operator()(j2,l2)*a3/(dx*dy);
00065 
00066 }
00067 
00068 
00069 
00070 <span class="keywordtype">void</span> FieldXY::Pic2Field(<span class="keywordtype">float</span> pic_charge, <span class="keywordtype">double</span> pic_pos_x, <span class="keywordtype">double</span> pic_pos_y)
00071 {
00072  <span class="keywordtype">int</span> j1,j2,l1,l2;
00073  <span class="keywordtype">float</span> a1, a2, a3, a4;
00074   
00075  j1=(int)floor((pic_pos_x+0.5*(NX-1.0)*dx)/dx);
00076  j2=j1+1;
00077  l1=(int)floor((pic_pos_y+0.5*(NY-1.0)*dy)/dy); 
00078  l2=l1+1;
00079 
00080  a1=(x[j2]-pic_pos_x)*(pic_pos_y-y[l1]);
00081  a2=(x[j2]-pic_pos_x)*(y[l2]-pic_pos_y);
00082  a3=(pic_pos_x-x[j1])*(pic_pos_y-y[l1]);
00083  a4=(pic_pos_x-x[j1])*(y[l2]-pic_pos_y);
00084 
00085  this-&gt;operator()(j1,l1) += a2*pic_charge/pow(dx*dy,2);
00086  this-&gt;operator()(j1,l2) += a1*pic_charge/pow(dx*dy,2);
00087  this-&gt;operator()(j2,l1) += a4*pic_charge/pow(dx*dy,2);
00088  this-&gt;operator()(j2,l2) += a3*pic_charge/pow(dx*dy,2);
00089 
00090 }
00091 
00092 
00093 <span class="keywordtype">void</span> FieldXY::print()
00094 {
00095  <span class="keywordtype">int</span> j, l; 
00096  <span class="keywordtype">float</span> *tem=<span class="keyword">new</span> <span class="keywordtype">float</span>[NY];
00097  <span class="keywordflow">for</span>(j=0; j&lt;NX; j++)
00098    {
00099     <span class="keywordflow">for</span>(l=0; l&lt;NY; l++)
00100       tem[l]=field[l+NY*j];
00101     fwrite(tem,<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>),NY,out); 
00102    }
00103  fflush(out);
00104  <span class="keyword">delete</span> tem; 
00105 }
00106 
00107 
00108 <span class="keywordtype">void</span> FieldXY::PoissonSolver(FieldXY&amp; Ex, FieldXY&amp; Ey)
00109 {
00110  <span class="keywordtype">int</span> j, l;
00111   
00112  poisson_xy(field,NX,NY,dx,dy);  
00113 
00114  <span class="keywordflow">for</span>(j=1;j&lt;NX-1;j++)
00115   <span class="keywordflow">for</span>(l=1;l&lt;NY-1;l++)
00116    {
00117     Ex(j,l)=-(this-&gt;operator()(j+1,l)-this-&gt;operator()(j-1,l))/(2.0*dx);
00118     Ey(j,l)=-(this-&gt;operator()(j,l+1)-this-&gt;operator()(j,l-1))/(2.0*dy);
00119    }
00120 }
</pre></div><hr><address style="align: right;"><small>Generated on Mon Feb 21 10:22:20 2005 for Track by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3 </small></address>
</body>
</html>
